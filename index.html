<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Team GTA North ‚Äì Bundle Maker (All Protectors)</title>
  <style>
    :root {
      --red-main: #c8102e;
      --red-dark: #850018;
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --text-main: #222222;
      --text-muted: #666666;
      --border: #dddddd;
      --accent: #0077b6;
      --radius-lg: 18px;
      --radius-md: 10px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffe5e9 0, #f5f5f7 40%, #e9f2ff 100%);
      color: var(--text-main);
    }
    .page-wrap { min-height: 100vh; padding: 24px; display: flex; justify-content: center; }
    .container { width: 100%; max-width: 1350px; }

    .header-card {
      background: linear-gradient(135deg, var(--red-dark), var(--red-main));
      color: #fff;
      border-radius: 24px;
      padding: 20px 24px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 14px 40px rgba(0,0,0,0.25);
    }
    .header-left h1 {
      margin: 0 0 4px 0;
      font-size: 24px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    .header-left p { margin: 0; font-size: 13px; opacity: 0.9; }
    .header-right { text-align: right; font-size: 12px; opacity: 0.9; }
    .header-right strong { display: block; font-size: 13px; }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 16px 18px 18px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.12);
      border: 1px solid rgba(0,0,0,0.04);
    }
    .card + .card { margin-top: 16px; }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .card-header h2 { margin: 0; font-size: 18px; }
    .hint { font-size: 12px; color: var(--text-muted); margin: 0 0 4px 0; }

    .table-wrap { width: 100%; overflow-x: auto; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
      min-width: 1150px;
    }
    thead { background: #fafafa; }
    th, td { padding: 6px 5px; text-align: left; border-bottom: 1px solid #eee; }
    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      border-bottom: 1px solid #e0e0e0;
    }
    tbody tr:nth-child(even) { background: #fcfcfc; }

    select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 3px 4px;
      font-size: 12px;
      border-radius: var(--radius-md);
      border: 1px solid #d0d0d0;
      outline: none;
      background: #fff;
    }
    input[type="number"] { text-align: right; }
    input[readonly] { background: #f7f7f7; color: #555; }
    select:focus, input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0,119,182,0.15);
    }

    .btn-row { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    .btn-primary { background: var(--red-main); color: #fff; }
    .btn-secondary { background: #f0f0f3; color: #333; }
    .btn-danger { background: #ffe7ea; color: #b00020; }
    .btn span.icon { font-size: 14px; }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }
    .summary-item {
      background: #fafafa;
      border-radius: var(--radius-md);
      padding: 8px 10px;
      border: 1px solid #ebebeb;
    }
    .summary-item label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      display: block;
      margin-bottom: 3px;
    }
    .summary-item .value { font-size: 15px; font-weight: 600; }
    .summary-item .value.accent { color: var(--red-main); }
    .summary-item small {
      display: block;
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      flex-wrap: wrap;
    }
    .footer-note strong { color: var(--red-dark); }

    @media (max-width: 900px) {
      .summary-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .header-card { flex-direction: column; align-items: flex-start; gap: 10px; }
      .header-right { text-align: left; }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="container">
      <div class="header-card">
        <div class="header-left">
          <h1>Team GTA North ‚Äì Bundle Maker</h1>
          <p>Model mattress & protection offers with built-in cost, GP and commission view.</p>
        </div>
        <div class="header-right">
          <strong>Commission</strong>
          <span>Commission is auto-calculated per line based on category.</span>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>Line Items</h2>
        </div>
        <p class="hint">
          1) Pick a SKU from the catalog. 2) Size, brand, retail and cost auto-fill. 3) Adjust % off or selling price to test different offers.
        </p>
        <div class="table-wrap">
          <table id="bundle-table">
            <thead>
              <tr>
                <th style="width: 20%;">Catalog item (SKU from sheet)</th>
                <th style="width: 6%;">Size</th>
                <th style="width: 12%;">Brand</th>
                <th style="width: 12%;">Item note</th>
                <th style="width: 9%;">Category</th>
                <th style="width: 8%;">Retail $</th>
                <th style="width: 7%;">Deal %</th>
                <th style="width: 8%;">Selling $</th>
                <th style="width: 8%;">Cost $</th>
                <th style="width: 7%;">GP $</th>
                <th style="width: 7%;">GP %</th>
                <th style="width: 7%;">Comm. $</th>
                <th style="width: 5%;"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="btn-row">
          <button class="btn btn-primary" type="button" onclick="addRow()">
            <span class="icon">‚ûï</span> Add blank line
          </button>
          <button class="btn btn-secondary" type="button" onclick="addPresetProtectBundle()">
            <span class="icon">üõèÔ∏è</span> Sample Q mattress + Bloom + Hush + Extend
          </button>
          <button class="btn btn-danger" type="button" onclick="clearAll()">
            <span class="icon">üóëÔ∏è</span> Clear all
          </button>
        </div>
      </div>

      <div class="card" style="margin-top: 18px;">
        <div class="card-header">
          <h2>Bundle Summary</h2>
        </div>
        <p class="hint">
          Use this view to compare different bundle ideas and make sure the math works for the customer and for you.
        </p>
        <div class="summary-grid">
          <div class="summary-item">
            <label>Total selling</label>
            <div class="value" id="sum-selling">$0.00</div>
            <small>Sum of all line item selling prices</small>
          </div>
          <div class="summary-item">
            <label>Total cost</label>
            <div class="value" id="sum-cost">$0.00</div>
            <small>What we pay (estimate)</small>
          </div>
          <div class="summary-item">
            <label>Total GP</label>
            <div class="value accent" id="sum-gp">$0.00</div>
            <small>Selling ‚àí cost</small>
          </div>
          <div class="summary-item">
            <label>Overall GP %</label>
            <div class="value" id="sum-gp-percent">0.0%</div>
            <small>GP √∑ selling across the whole bundle</small>
          </div>
        </div>
        <div class="summary-grid" style="margin-top: 10px;">
          <div class="summary-item">
            <label>Total commission</label>
            <div class="value accent" id="sum-comm">$0.00</div>
            <small>Auto-calculated based on category</small>
          </div>
          <div class="summary-item">
            <label>Avg commission per $100 sold</label>
            <div class="value" id="sum-comm-per-100">$0.00</div>
            <small>Commission √∑ (selling √∑ 100)</small>
          </div>
          <div class="summary-item">
            <label>Mattress & Extend selling</label>
            <div class="value" id="sum-mattress-extend">$0.00</div>
            <small>Core ticket value</small>
          </div>
          <div class="summary-item">
            <label>Accessories selling</label>
            <div class="value" id="sum-accessories">$0.00</div>
            <small>Protectors, pads, encasements, etc.</small>
          </div>
        </div>

        <div class="footer-note">
          <span><strong>Team GTA North ‚Äì One Region, One Standard.</strong></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const COMM_RATES = {
      "mattress": 0.125,
      "extend": 0.125,
      "accessory": 0.18,
      "other": 0.0
    };

    const CATALOG = [
      { sku: "23BECMP-1", size: "T",   cost: 34.00, retail: 99.00,  category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-2", size: "F",   cost: 40.00, retail: 109.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-3", size: "Q",   cost: 43.00, retail: 119.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-4", size: "K",   cost: 50.00, retail: 129.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-6", size: "TXL", cost: 32.00, retail: 105.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECMP-7", size: "FXL", cost: 43.00, retail: 119.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },

      { sku: "23BECPP-3", size: "Q", cost: 13.00, retail: 39.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },
      { sku: "23BECPP-4", size: "K", cost: 15.00, retail: 45.00, category: "accessory", brand: "Bloom Essentials", source: "Bloom Essentials" },

      { sku: "23BETMP-1", size: "T",   cost: 37.00, retail: 119.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-2", size: "F",   cost: 43.00, retail: 139.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-3", size: "Q",   cost: 51.00, retail: 149.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-4", size: "K",   cost: 51.00, retail: 179.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },
      { sku: "23BETMP-6", size: "TXL", cost: 40.00, retail: 139.00, category: "accessory", brand: "Bloom Essentials Terry", source: "Bloom Essentials" },

      { sku: "23BESMP-3SQ", size: "SHQ", cost: 35.00, retail: 149.00, category: "accessory", brand: "Bloom Split", source: "Bloom Essentials" },
      { sku: "23BESMP-4SK", size: "SHK", cost: 36.00, retail: 169.00, category: "accessory", brand: "Bloom Split", source: "Bloom Essentials" },

      { sku: "23BEME-1", size: "T",   cost: 48.00, retail: 149.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-2", size: "F",   cost: 56.00, retail: 189.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-3", size: "Q",   cost: 57.00, retail: 199.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-4", size: "K",   cost: 64.00, retail: 209.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },
      { sku: "23BEME-6", size: "TXL", cost: 54.00, retail: 159.00, category: "accessory", brand: "Bloom Encasement", source: "Bloom Essentials" },

      { sku: "23BEBE-1", size: "T",   cost: 42.00, retail: 89.00,  category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },
      { sku: "23BEBE-2", size: "F",   cost: 51.00, retail: 99.00,  category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },
      { sku: "23BEBE-3", size: "Q",   cost: 55.00, retail: 109.00, category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },
      { sku: "23BEBE-6", size: "TXL", cost: 25.00, retail: 90.00,  category: "accessory", brand: "Bloom Boxspring", source: "Bloom Essentials" },

      { sku: "24SGMP-3", size: "Q", cost: 74.00, retail: 169.00, category: "accessory", brand: "Simba Green", source: "Simba Green" },
      { sku: "24SGMP-4", size: "K", cost: 87.00, retail: 199.00, category: "accessory", brand: "Simba Green", source: "Simba Green" },

      { sku: "16CLIMAMP-1", size: "T",   cost: 44.00, retail: 139.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-2", size: "F",   cost: 58.00, retail: 149.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-3", size: "Q",   cost: 64.00, retail: 179.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-4", size: "K",   cost: 81.00, retail: 199.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-6", size: "TXL", cost: 50.00, retail: 179.00, category: "accessory", brand: "Clima", source: "Clima" },
      { sku: "16CLIMAMP-7", size: "FXL", cost: 66.00, retail: 179.00, category: "accessory", brand: "Clima", source: "Clima" },

      { sku: "25HTSMP-1", size: "T",   cost: 62.00, retail: 169.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-2", size: "F",   cost: 72.00, retail: 189.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-3", size: "Q",   cost: 76.00, retail: 199.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-4", size: "K",   cost: 89.00, retail: 229.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-6", size: "TXL", cost: 71.00, retail: 189.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-3SH", size: "SHQ", cost: 82.00, retail: 219.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSMP-4SH", size: "SHK", cost: 97.00, retail: 249.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },

      { sku: "25HTSPP-2", size: "S/Q", cost: 44.00, retail: 99.00,  category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },
      { sku: "25HTSPP-4", size: "K",   cost: 47.00, retail: 119.00, category: "accessory", brand: "Hush Graph-Iced", source: "Hush" },

      { sku: "25HATMP-1", size: "T",   cost: 89.00, retail: 219.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-2", size: "F",   cost: 93.00, retail: 229.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-3", size: "Q",   cost: 98.00, retail: 249.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-4", size: "K",   cost: 113.00, retail: 289.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-6", size: "TXL", cost: 89.00, retail: 229.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-3SH", size: "SHQ", cost: 106.00, retail: 269.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATMP-4SH", size: "SHK", cost: 119.00, retail: 309.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },

      { sku: "25HATPP-2", size: "S/Q", cost: 50.00, retail: 119.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },
      { sku: "25HATPP-4", size: "K",   cost: 52.00, retail: 129.00, category: "accessory", brand: "Hush ArchTech", source: "Hush" },

      { sku: "18PROTEX-1", size: "T",   cost: 82.00, retail: 219.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-2", size: "F",   cost: 86.00, retail: 229.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-3", size: "Q",   cost: 105.00, retail: 249.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-4", size: "K",   cost: 142.00, retail: 289.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },
      { sku: "18PROTEX-6", size: "TXL", cost: 81.00, retail: 219.00, category: "accessory", brand: "Tempur-Protex-It", source: "Tempur" },

      { sku: "20PURMP-3", size: "Q",   cost: 95.00, retail: 269.00, category: "accessory", brand: "Purple", source: "Purple" },
      { sku: "20PURMP-4", size: "K",   cost: 103.00, retail: 299.00, category: "accessory", brand: "Purple", source: "Purple" },
      { sku: "20PURMP-6", size: "TXL", cost: 76.00, retail: 219.00, category: "accessory", brand: "Purple", source: "Purple" },

      { sku: "25HGIMP-1", size: "T",   cost: 91.00, retail: 249.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-2", size: "F",   cost: 102.00, retail: 279.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-3", size: "Q",   cost: 108.00, retail: 299.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-4", size: "K",   cost: 122.00, retail: 349.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-6", size: "TXL", cost: 120.00, retail: 299.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-3SH", size: "SHQ", cost: 121.00, retail: 329.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIMP-4SH", size: "SHK", cost: 130.00, retail: 369.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },

      { sku: "25HGIPP-2", size: "S/Q", cost: 51.00, retail: 139.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },
      { sku: "25HGIPP-4", size: "K",   cost: 54.00, retail: 149.00, category: "accessory", brand: "Hush Triple-Shield", source: "Hush" },

      { sku: "19PRTCMP-1", size: "T",   cost: 58.00, retail: 149.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-2", size: "F",   cost: 70.00, retail: 169.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-3", size: "Q",   cost: 74.00, retail: 179.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-4", size: "K",   cost: 98.00, retail: 209.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-6", size: "TXL", cost: 57.00, retail: 169.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCMP-3S", size: "SHQ", cost: 76.00, retail: 199.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },

      { sku: "19PRTCTPP-3", size: "Q", cost: 37.00, retail: 100.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },
      { sku: "19PRTCTPP-4", size: "K", cost: 43.00, retail: 110.00, category: "accessory", brand: "Malouf Protect", source: "Malouf" },

      { sku: "19CMFMP-1", size: "T",   cost: 76.00, retail: 199.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-2", size: "F",   cost: 77.00, retail: 209.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-3", size: "Q",   cost: 82.00, retail: 229.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-4", size: "K",   cost: 109.00, retail: 269.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-6", size: "TXL", cost: 71.00, retail: 199.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-3SQ", size: "SHQ", cost: 98.00, retail: 229.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFMP-4SK", size: "SHK", cost: 126.00, retail: 269.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },

      { sku: "19CMFPP-3", size: "Q", cost: 49.00, retail: 110.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },
      { sku: "19CMFPP-4", size: "K", cost: 54.00, retail: 120.00, category: "accessory", brand: "Malouf Comfort", source: "Malouf" },

      { sku: "19RFRSMP-1", size: "T",   cost: 116.00, retail: 229.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-2", size: "F",   cost: 131.00, retail: 259.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-3", size: "Q",   cost: 140.00, retail: 279.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-4", size: "K",   cost: 158.00, retail: 309.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },
      { sku: "19RFRSMP-6", size: "TXL", cost: 117.00, retail: 229.00, category: "accessory", brand: "Malouf Refresh", source: "Malouf" },

      { sku: "17ENCAS12-1", size: "T",   cost: 38.00, retail: 149.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-2", size: "F",   cost: 45.00, retail: 189.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-3", size: "Q",   cost: 48.00, retail: 199.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-4", size: "K",   cost: 57.00, retail: 209.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },
      { sku: "17ENCAS12-6", size: "TXL", cost: 47.00, retail: 159.00, category: "accessory", brand: "Sunset Encasement 12in", source: "Sunset" },

      { sku: "17ENCAS09-1", size: "T",   cost: 22.00, retail: 89.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },
      { sku: "17ENCAS09-2", size: "F",   cost: 25.00, retail: 99.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },
      { sku: "17ENCAS09-3", size: "Q",   cost: 30.00, retail: 109.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },
      { sku: "17ENCAS09-6", size: "TXL", cost: 22.00, retail: 99.00, category: "accessory", brand: "Sunset Boxspring 8.5in", source: "Sunset" },

      { sku: "19RENEWMP-3", size: "Q",   cost: 96.00, retail: 289.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },
      { sku: "19RENEWMP-4", size: "K",   cost: 113.00, retail: 309.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },
      { sku: "19RENEWMP-6", size: "TXL", cost: 80.00, retail: 229.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },

      { sku: "CLASSMP-1", size: "T",   cost: 32.00, retail: 99.00,  category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-2", size: "F",   cost: 40.00, retail: 109.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-3", size: "Q",   cost: 43.00, retail: 119.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-4", size: "K",   cost: 50.00, retail: 129.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-6", size: "TXL", cost: 32.00, retail: 105.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSMP-7", size: "FXL", cost: 41.00, retail: 119.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },

      { sku: "CLASSPP-3", size: "Q", cost: 12.00, retail: 39.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },
      { sku: "CLASSPP-4", size: "K", cost: 14.00, retail: 45.00, category: "accessory", brand: "Classic Cotton", source: "Classic" },

      { sku: "20TERRYMP-1", size: "T",   cost: 34.00, retail: 119.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-2", size: "F",   cost: 41.00, retail: 139.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-3", size: "Q",   cost: 47.00, retail: 149.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-4", size: "K",   cost: 42.00, retail: 179.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },
      { sku: "20TERRYMP-6", size: "TXL", cost: 38.00, retail: 139.00, category: "accessory", brand: "Safe Sleep Terry", source: "Safe Sleep" },

      { sku: "16NQMP-3SQ", size: "SHQ", cost: 31.00, retail: 149.00, category: "accessory", brand: "Non Quilted Split", source: "Protect-A-Bed" },
      { sku: "16NQMP-4SK", size: "SHK", cost: 32.00, retail: 169.00, category: "accessory", brand: "Non Quilted Split", source: "Protect-A-Bed" },

      { sku: "PABMP-1", size: "T",   cost: 48.00, retail: 120.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-2", size: "F",   cost: 63.00, retail: 140.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-3", size: "Q",   cost: 69.00, retail: 150.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-4", size: "K",   cost: 90.00, retail: 180.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABMP-6", size: "TXL", cost: 52.00, retail: 140.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },

      { sku: "PABPP-2", size: "F", cost: 13.00, retail: 40.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABPP-3", size: "Q", cost: 15.00, retail: 46.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },
      { sku: "PABPP-4", size: "K", cost: 16.00, retail: 50.00, category: "accessory", brand: "Protect-A-Bed", source: "Protect-A-Bed" },

      { sku: "THERMP-1", size: "T",   cost: 72.00, retail: 160.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-2", size: "F",   cost: 78.00, retail: 180.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-3", size: "Q",   cost: 88.00, retail: 200.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-4", size: "K",   cost: 102.00, retail: 220.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },
      { sku: "THERMP-6", size: "TXL", cost: 75.00, retail: 160.00, category: "accessory", brand: "Therm-a-Sleep", source: "Therm-a-Sleep" },

      { sku: "19RENEWMP-3", size: "Q",   cost: 96.00, retail: 289.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },
      { sku: "19RENEWMP-4", size: "K",   cost: 113.00, retail: 309.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },
      { sku: "19RENEWMP-6", size: "TXL", cost: 80.00, retail: 229.00, category: "accessory", brand: "Malouf Renew", source: "Malouf" },

      { sku: "EXTENDMAT1",   size: "", cost: 8.99,  retail: 49.00,  category: "extend", brand: "Extend Mattress 1YR", source: "Extend" },
      { sku: "EXTENDMAT10",  size: "", cost: 19.03, retail: 99.00,  category: "extend", brand: "Extend Mattress 10YR", source: "Extend" },
      { sku: "EXTENDBASE10", size: "", cost: 39.50, retail: 149.00, category: "extend", brand: "Extend Base 10YR", source: "Extend" },
      { sku: "EXTENDBASEFM", size: "", cost: 44.50, retail: 149.00, category: "extend", brand: "Extend Base FM", source: "Extend" }
    ];

    const SIZE_OPTIONS = ["", "T", "F", "Q", "K", "TXL", "FXL", "SHQ", "SHK", "S/Q"];

    function formatMoney(n) {
      if (isNaN(n) || !isFinite(n)) return "$0.00";
      return "$" + n.toFixed(2);
    }
    function formatPercent(n) {
      if (isNaN(n) || !isFinite(n)) return "0.0%";
      return n.toFixed(1) + "%";
    }

    function buildCatalogOptions() {
      const sorted = [...CATALOG].sort((a, b) => {
        if (a.source === b.source) return a.sku.localeCompare(b.sku);
        return a.source.localeCompare(b.source);
      });
      const frag = document.createDocumentFragment();
      const optEmpty = document.createElement("option");
      optEmpty.value = "";
      optEmpty.textContent = "‚Äî Manual / custom item ‚Äî";
      frag.appendChild(optEmpty);

      const sources = [...new Set(sorted.map(p => p.source))];
      sources.forEach(source => {
        const group = document.createElement("optgroup");
        group.label = source;
        sorted.filter(p => p.source === source).forEach(p => {
          const opt = document.createElement("option");
          opt.value = p.sku;
          const sizeText = p.size ? " ‚Äì " + p.size : "";
          opt.textContent = p.sku + sizeText + " ‚Äì $" + p.retail.toFixed(2);
          group.appendChild(opt);
        });
        frag.appendChild(group);
      });

      return frag;
    }

    function getProductBySku(sku) {
      return CATALOG.find(p => p.sku === sku) || null;
    }

    function findProductByFamilyAndSize(baseSku, size) {
      if (!baseSku || !size) return null;
      return CATALOG.find(p => p.sku.startsWith(baseSku + "-") && p.size === size) || null;
    }

    function applyCatalogToRow(row, sku) {
      const prod = getProductBySku(sku);
      const sizeEl = row.querySelector(".item-size");
      const brandEl = row.querySelector(".item-brand");
      const nameEl = row.querySelector(".item-name");
      const catEl = row.querySelector(".item-category");
      const retailEl = row.querySelector(".item-retail");
      const sellEl = row.querySelector(".item-selling");
      const costEl = row.querySelector(".item-cost");
      const dealEl = row.querySelector(".item-deal");

      if (!prod) {
        if (sizeEl) sizeEl.value = "";
        brandEl.value = "";
        if (!nameEl.value) nameEl.value = "";
        retailEl.value = "";
        sellEl.value = "";
        costEl.value = "";
        dealEl.value = "";
        return;
      }

      if (sizeEl) sizeEl.value = prod.size || "";
      brandEl.value = prod.brand || "";
      if (!nameEl.value) nameEl.value = prod.sku;
      catEl.value = prod.category || "accessory";
      retailEl.value = prod.retail.toFixed(2);
      costEl.value = prod.cost.toFixed(2);
      dealEl.value = "0";
      sellEl.value = prod.retail.toFixed(2);
    }

    function buildSizeSelect() {
      const select = document.createElement("select");
      select.className = "item-size";
      SIZE_OPTIONS.forEach(val => {
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = val;
        select.appendChild(opt);
      });
      return select;
    }

    function onSizeChange(row) {
      const sizeEl = row.querySelector(".item-size");
      const catalogEl = row.querySelector(".item-catalog");
      if (!sizeEl || !catalogEl) return;

      const newSize = sizeEl.value;
      const currentSku = catalogEl.value;

      if (!currentSku) {
        // no SKU selected, just recalc summary
        recalcAll();
        return;
      }

      const baseSku = currentSku.split("-")[0];
      const prod = findProductByFamilyAndSize(baseSku, newSize);

      if (prod) {
        // switch SKU to matching size and update pricing
        catalogEl.value = prod.sku;
        applyCatalogToRow(row, prod.sku);
      } else {
        // if we don't have a match, just leave prices as-is
        // but still update summary
      }
      recalcAll();
    }

    function addRow(preset = {}) {
      const tbody = document.querySelector("#bundle-table tbody");
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>
          <select class="item-catalog"></select>
        </td>
        <td class="size-cell"></td>
        <td>
          <input type="text" class="item-brand" readonly />
        </td>
        <td>
          <input type="text" class="item-name" placeholder="Note, description, etc." />
        </td>
        <td>
          <select class="item-category">
            <option value="mattress">Mattress</option>
            <option value="extend">Extend</option>
            <option value="accessory">Accessory</option>
            <option value="other">Other</option>
          </select>
        </td>
        <td>
          <input type="number" class="item-retail" min="0" step="0.01" readonly />
        </td>
        <td>
          <input type="number" class="item-deal" min="-90" max="90" step="0.5" value="0" />
        </td>
        <td>
          <input type="number" class="item-selling" min="0" step="0.01" />
        </td>
        <td>
          <input type="number" class="item-cost" min="0" step="0.01" />
        </td>
        <td>
          <input type="text" class="item-gp" readonly />
        </td>
        <td>
          <input type="text" class="item-gp-percent" readonly />
        </td>
        <td>
          <input type="text" class="item-comm-amt" readonly />
        </td>
        <td style="text-align:center;">
          <button type="button" class="btn btn-danger" style="padding:2px 8px; font-size:11px;" onclick="removeRow(this)">‚úï</button>
        </td>
      `;

      // Attach size dropdown
      const sizeCell = row.querySelector(".size-cell");
      const sizeSelect = buildSizeSelect();
      sizeSelect.addEventListener("change", () => onSizeChange(row));
      sizeCell.appendChild(sizeSelect);

      const catalogSelect = row.querySelector(".item-catalog");
      catalogSelect.appendChild(buildCatalogOptions());

      if (preset.sku) {
        catalogSelect.value = preset.sku;
        applyCatalogToRow(row, preset.sku);
      } else if (preset.name) {
        row.querySelector(".item-name").value = preset.name;
      }

      catalogSelect.addEventListener("change", () => {
        const sku = catalogSelect.value;
        applyCatalogToRow(row, sku);
        recalcAll();
      });

      const dealEl = row.querySelector(".item-deal");
      dealEl.addEventListener("input", () => {
        applyDealToRow(row);
        recalcAll();
      });

      row.querySelectorAll("input, select").forEach(el => {
        if (el.classList.contains("item-catalog")) return;
        if (el.classList.contains("item-size") ||
            el.classList.contains("item-brand") ||
            el.classList.contains("item-retail") ||
            el.classList.contains("item-gp") ||
            el.classList.contains("item-gp-percent") ||
            el.classList.contains("item-comm-amt") ||
            el.classList.contains("item-deal")) return;
        el.addEventListener("input", recalcAll);
        el.addEventListener("change", recalcAll);
      });

      tbody.appendChild(row);
      recalcAll();
    }

    function applyDealToRow(row) {
      const retailEl = row.querySelector(".item-retail");
      const dealEl = row.querySelector(".item-deal");
      const sellEl = row.querySelector(".item-selling");
      const retail = parseFloat(retailEl.value || "0");
      const deal = parseFloat(dealEl.value || "0");

      if (retail > 0 && !isNaN(deal)) {
        const selling = retail * (1 - deal / 100);
        sellEl.value = selling.toFixed(2);
      }
    }

    function removeRow(btn) {
      const tr = btn.closest("tr");
      if (tr) tr.remove();
      recalcAll();
    }

    function clearAll() {
      document.querySelector("#bundle-table tbody").innerHTML = "";
      recalcAll();
    }

    function addRowAndReturn(preset) {
      const tbody = document.querySelector("#bundle-table tbody");
      addRow(preset);
      const rows = tbody.querySelectorAll("tr");
      return rows[rows.length - 1];
    }

    function addPresetProtectBundle() {
      clearAll();
      addRow({ name: "Queen Mattress (manual)", sku: "" });
      addRowAndReturn({ sku: "23BECMP-3" });
      addRowAndReturn({ sku: "25HTSMP-3" });
      addRowAndReturn({ sku: "EXTENDMAT10" });
    }

    function recalcAll() {
      const rows = document.querySelectorAll("#bundle-table tbody tr");

      let sumSelling = 0;
      let sumCost = 0;
      let sumGP = 0;
      let sumComm = 0;
      let sumMattressExtend = 0;
      let sumAccessories = 0;

      rows.forEach(row => {
        const category = (row.querySelector(".item-category")?.value || "mattress").toLowerCase();
        const sellVal = parseFloat(row.querySelector(".item-selling")?.value || "0");
        const costVal = parseFloat(row.querySelector(".item-cost")?.value || "0");

        const gp = sellVal - costVal;
        const gpPercent = sellVal > 0 ? (gp / sellVal) * 100 : 0;

        const rate = COMM_RATES[category] ?? 0;
        const commAmt = sellVal * rate;

        row.querySelector(".item-gp").value = formatMoney(gp);
        row.querySelector(".item-gp-percent").value = formatPercent(gpPercent);
        row.querySelector(".item-comm-amt").value = formatMoney(commAmt);

        sumSelling += sellVal;
        sumCost += costVal;
        sumGP += gp;
        sumComm += commAmt;

        if (category === "mattress" || category === "extend") {
          sumMattressExtend += sellVal;
        } else if (category === "accessory") {
          sumAccessories += sellVal;
        }
      });

      const overallGPPercent = sumSelling > 0 ? (sumGP / sumSelling) * 100 : 0;
      const commPer100 = sumSelling > 0 ? sumComm / (sumSelling / 100) : 0;

      document.getElementById("sum-selling").textContent = formatMoney(sumSelling);
      document.getElementById("sum-cost").textContent = formatMoney(sumCost);
      document.getElementById("sum-gp").textContent = formatMoney(sumGP);
      document.getElementById("sum-gp-percent").textContent = formatPercent(overallGPPercent);
      document.getElementById("sum-comm").textContent = formatMoney(sumComm);
      document.getElementById("sum-comm-per-100").textContent = formatMoney(commPer100);
      document.getElementById("sum-mattress-extend").textContent = formatMoney(sumMattressExtend);
      document.getElementById("sum-accessories").textContent = formatMoney(sumAccessories);
    }

    window.addEventListener("DOMContentLoaded", () => {
      addRow();
    });
  </script>
</body>
</html>
